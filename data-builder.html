<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pacts Data Builder</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #111; color: #eee; }
    textarea { width: 100%; height: 300px; margin-top: 10px; }
    button { padding: 10px 15px; margin-right: 10px; }
  </style>
</head>

<body>
  <h1>Pacts Data Builder</h1>

  <p>This tool queries the Avakot GraphQL API, normalizes the data, and generates a JSON file matching our Soulframe Atlas schema.</p>

  <button id="runQueryBtn">Run Pacts Query</button>
<button id="saveBtn" disabled>Save to Repo</button>

<textarea id="output"></textarea>

<script>
const gqlEndpoint = "https://api.avakot.org/v1/gql";
const workerEndpoint = "https://update-pacts.paytonbaldridge.workers.dev"; // update this

const pactsQuery = `
query GetPacts {
  pacts {
    ItemID
    Ingame
    Description
    Icon
    Abilities
    BonusHP
    BonusVirtueType
    BonusVirtueValue
    MagickDefence
    PhysicalDefence
    StabilityIncrease
    UnnarmedDmg
    VirtueOrder
    Craft
    InternalID
  }
}
`;

let generatedJSON = "";

async function runPactsQuery() {
  const response = await fetch(gqlEndpoint, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: pactsQuery })
  });

  const data = await response.json();
  const pactsRaw = data?.data?.pacts || [];

  // Example normalization – tweak later as you like
  const normalized = pactsRaw.map(p => ({
    id: p.ItemID || "",
    name: p.Ingame || p.ItemID || "",
    description: p.Description || "",
    icon: p.Icon || "",
    abilities: p.Abilities || "",
    bonus: {
      hp: p.BonusHP || 0,
      virtueType: p.BonusVirtueType || "",
      virtueValue: p.BonusVirtueValue || 0
    },
    defense: {
      magick: p.MagickDefence || 0,
      physical: p.PhysicalDefence || 0,
      stabilityIncrease: p.StabilityIncrease || 0
    },
    unarmedDamage: p.UnnarmedDmg || 0,
    virtueOrder: p.VirtueOrder || "",
    craft: p.Craft || {},
    internalId: p.InternalID || "",
    links: { wiki: "", externalGuide: "" }
  }));

  generatedJSON = JSON.stringify({ pacts: normalized }, null, 2);
  document.getElementById("output").value = generatedJSON;

  document.getElementById("saveBtn").disabled = !generatedJSON;
}

async function saveToRepo() {
  if (!generatedJSON) return;

  const res = await fetch(workerEndpoint, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: generatedJSON
  });

  if (res.ok) {
    alert("pacts.json updated in repo ✅");
  } else {
    const text = await res.text();
    alert("Failed to update pacts.json ❌\n" + text);
  }
}

document.getElementById("runQueryBtn").onclick = runPactsQuery;
document.getElementById("saveBtn").onclick = saveToRepo;
</script>


</body>
</html>



